<div class="container mt-4 mb-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      
      <!-- TARJETA DE PERFIL -->
      <div class="card shadow-sm border-0">
        <div class="card-body text-center pt-5 pb-4">
          
          <!-- SPINNER DE CARGA (Visible mientras profile es null) -->
          <div *ngIf="!profile" class="py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>

          <!-- CONTENIDO DEL PERFIL (Solo visible cuando profile existe) -->
          <div *ngIf="profile">
            
            <!-- FOTO DE PERFIL -->
            <div class="position-relative d-inline-block mb-3">
              <img 
                [src]="profilePic" 
                (error)="onImageError($event)"
                class="profile-img rounded-circle shadow-sm"
                alt="Foto de perfil"
              >
              
              <!-- Botón de cámara (Solo visible en modo edición) -->
              <label *ngIf="editing" class="upload-btn" title="Cambiar foto">
                <i class="fa fa-camera"></i>
                <input type="file" (change)="onFileSelected($event)" accept="image/*" hidden>
              </label>
            </div>

            <h2 class="fw-bold text-primary mb-1">{{ profile.name }} {{ profile.surname }}</h2>
            <p class="text-muted mb-4">&#64;{{ profile.userName }}</p>

            <!-- FORMULARIO DE DATOS -->
            <div class="text-start px-md-5">
              
              <div class="mb-3">
                <label class="form-label text-muted small fw-bold">Email</label>
                <!-- Eliminamos [value], dejamos solo [(ngModel)] -->
                <input type="email" class="form-control" [disabled]="!editing" [(ngModel)]="profile.email">
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label text-muted small fw-bold">Nombre</label>
                  <input type="text" class="form-control" [disabled]="!editing" [(ngModel)]="profile.name">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label text-muted small fw-bold">Apellido</label>
                  <input type="text" class="form-control" [disabled]="!editing" [(ngModel)]="profile.surname">
                </div>
              </div>
              
              

              <!-- BOTONES DE ACCIÓN -->
              <div class="d-grid gap-2">
                <button *ngIf="!editing" class="btn btn-primary" (click)="toggleEdit()">
                  <i class="fa fa-pencil me-2"></i> Editar Perfil
                </button>
                
                <div *ngIf="editing" class="d-flex gap-2">
                   <button class="btn btn-secondary w-50" (click)="toggleEdit()">Cancelar</button>
                   <button class="btn btn-success w-50" (click)="save()">Guardar Cambios</button>
                </div>
              </div>

            </div>
          </div> 
          <!-- Fin *ngIf="profile" -->

        </div>
      </div>

      <!-- SECCIÓN CONTRASEÑA -->
      <div class="card shadow-sm border-0 mt-4">
        <div class="card-header bg-white py-3">
          <h5 class="m-0 fw-bold text-secondary">Cambiar contraseña</h5>
        </div>
        <div class="card-body p-4">
          <div class="mb-3">
             <label class="form-label small">Contraseña actual</label>
             <input type="password" class="form-control bg-light" [(ngModel)]="password.currentPassword">
          </div>
          <div class="mb-3">
             <label class="form-label small">Nueva contraseña</label>
             <input type="password" class="form-control bg-light" [(ngModel)]="password.newPassword">
          </div>
          <div class="mb-3">
             <label class="form-label small">Confirmar nueva contraseña</label>
             <input type="password" class="form-control bg-light" [(ngModel)]="password.confirmPassword">
          </div>
          <button class="btn btn-warning text-white w-100" (click)="changePassword()">
             Actualizar contraseña
          </button>
        </div>
      </div>

      <!-- ZONA DE PELIGRO -->
      <div class="card border-danger mt-5">
        <div class="card-body d-flex justify-content-between align-items-center">
           <div>
              <h6 class="text-danger fw-bold mb-1">Eliminar Cuenta</h6>
              <small class="text-muted">Esta acción es irreversible y borrará todos tus datos.</small>
           </div>
           <button class="btn btn-outline-danger btn-sm" (click)="deleteAccount()">Eliminar</button>
        </div>
      </div>

    </div>
  </div>
</div>